<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{fragments/header :: head(${seo})}"></head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PFPKQT7W"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div th:replace="~{fragments/header :: [th:fragment='header']}"></div>

<main class="container">
    <div class="dashboard-header">
        <h1><span th:text="${ownerId}">user</span>님의 대시보드</h1>
        <button class="btn btn-primary" onclick="openCreateModal()">+ 새 일정</button>
    </div>

    <section class="schedules-grid" th:if="${!schedules.isEmpty()}" aria-label="일정 목록">
        <article class="schedule-card" th:each="schedule : ${schedules}">
            <header class="schedule-card-header">
                <h3 th:text="${schedule.formattedYearMonth()}">2025-12</h3>
            </header>
            <div class="schedule-card-body">
                <p>
                    <span class="participant-count" th:text="${schedule.participantCount()}">0</span>
                    명 참여
                </p>
            </div>
            <footer class="schedule-card-actions">
                <a th:href="@{'/' + ${ownerId} + '/' + ${schedule.year()} + '/' + ${schedule.month()}}"
                   class="btn btn-secondary">보기</a>
                <button class="btn btn-outline copy-link-btn"
                        th:data-owner="${ownerId}"
                        th:data-year="${schedule.year()}"
                        th:data-month="${schedule.month()}">
                    링크 복사
                </button>
                <button class="btn btn-danger delete-btn"
                        th:data-owner="${ownerId}"
                        th:data-year="${schedule.year()}"
                        th:data-month="${schedule.month()}">
                    삭제
                </button>
            </footer>
        </article>
    </section>

    <div class="empty-state" th:if="${schedules.isEmpty()}">
        <p>아직 일정이 없습니다. 첫 번째 일정을 만들어보세요!</p>
        <button class="btn btn-primary" onclick="openCreateModal()">+ 새 일정</button>
    </div>
</main>

<!-- Create Schedule Modal -->
<div id="createModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="createModalTitle">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="createModalTitle">새 일정</h2>
            <button class="modal-close" onclick="closeCreateModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createScheduleForm">
                <div class="form-group">
                    <label for="year">연도</label>
                    <select id="year" name="year" required>
                        <option value="2024">2024</option>
                        <option value="2025" selected>2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="month">월</label>
                    <select id="month" name="month" required>
                        <option th:each="m : ${#numbers.sequence(1, 12)}"
                                th:value="${m}"
                                th:text="${m + '월'}"
                                th:selected="${m == 12}">12월</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">취소</button>
                    <button type="submit" class="btn btn-primary">만들기</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer :: [th:fragment='footer']}"></div>
<th:block th:replace="~{fragments/footer :: scripts}"></th:block>

<!-- Owner data injection for external script -->
<script th:inline="javascript">
    window.OWNER_DATA = { ownerId: [[${ownerId}]] };
</script>
<script defer th:src="@{/js/owner-dashboard.js}"></script>
</body>
</html>
