<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{trading/fragments/header :: header}"></head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen">

<nav th:replace="~{trading/fragments/header :: navbar}"></nav>

<main class="container mx-auto px-4 py-6">
    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <!-- Total Value -->
        <div class="card">
            <div class="stat-label">Total Value</div>
            <div class="stat-value" id="total-value">
                <span th:text="${#numbers.formatDecimal(profitSummary.totalValue(), 0, 0)}">0</span> KRW
            </div>
        </div>

        <!-- Unrealized P&L -->
        <div class="card">
            <div class="stat-label">Unrealized P&L</div>
            <div class="stat-value" id="unrealized-pnl"
                 th:classappend="${profitSummary.unrealizedPnl().compareTo(T(java.math.BigDecimal).ZERO) >= 0} ? 'positive' : 'negative'">
                <span th:text="${#numbers.formatDecimal(profitSummary.unrealizedPnlPct(), 1, 2)}">0</span>%
            </div>
        </div>

        <!-- Win Rate -->
        <div class="card">
            <div class="stat-label">Win Rate</div>
            <div class="stat-value">
                <span th:text="${#numbers.formatDecimal(profitSummary.winRate(), 1, 1)}">0</span>%
            </div>
            <div class="text-sm text-gray-500">
                <span th:text="${profitSummary.totalTrades()}">0</span> trades
            </div>
        </div>

        <!-- Bot Status -->
        <div class="card">
            <div class="stat-label">Bot Status</div>
            <div class="flex items-center space-x-2 mt-2">
                <span class="w-4 h-4 rounded-full" aria-hidden="true"
                      th:classappend="${botStatus.running()} ? (${botStatus.paused()} ? 'bg-yellow-500' : 'bg-green-500') : 'bg-red-500'"></span>
                <span class="font-medium"
                      th:text="${botStatus.running()} ? (${botStatus.paused()} ? 'Paused' : 'Running') : 'Stopped'">Stopped</span>
            </div>
            <div class="mt-3 flex space-x-2">
                <button onclick="toggleBot()" class="btn-primary text-sm" id="toggle-btn">
                    <span th:text="${botStatus.running()} ? 'Stop' : 'Start'">Start</span>
                </button>
                <button onclick="emergencyClose()" class="btn-danger text-sm">Emergency</button>
            </div>
        </div>
    </div>

    <!-- Chart Section -->
    <div class="card mb-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold dark:text-white">Price Chart - <span th:text="${market}">KRW-ADA</span></h2>
            <div class="flex items-center space-x-4">
                <span class="text-2xl font-bold dark:text-white" id="current-price">Loading...</span>
            </div>
        </div>
        <div id="chart-container" style="height: 400px;"></div>
    </div>

    <!-- Indicators & Positions -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Indicators -->
        <div class="card">
            <h3 class="text-lg font-semibold mb-4 dark:text-white">Technical Indicators</h3>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <div class="stat-label">RSI (14)</div>
                    <div class="stat-value text-lg" id="indicator-rsi">-</div>
                </div>
                <div>
                    <div class="stat-label">Stochastic K/D</div>
                    <div class="stat-value text-lg" id="indicator-stoch">-</div>
                </div>
                <div>
                    <div class="stat-label">MA5</div>
                    <div class="stat-value text-lg" id="indicator-ma5">-</div>
                </div>
                <div>
                    <div class="stat-label">MA20</div>
                    <div class="stat-value text-lg" id="indicator-ma20">-</div>
                </div>
            </div>
        </div>

        <!-- Recent Positions -->
        <div class="card">
            <h3 class="text-lg font-semibold mb-4 dark:text-white">Recent Positions</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="text-gray-500">
                        <tr>
                            <th scope="col" class="text-left py-2">Entry</th>
                            <th scope="col" class="text-left py-2">Exit</th>
                            <th scope="col" class="text-right py-2">P&L</th>
                            <th scope="col" class="text-left py-2">Reason</th>
                        </tr>
                    </thead>
                    <tbody id="positions-table" class="dark:text-gray-300">
                        <tr><td colspan="4" class="text-center py-4">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<script defer th:src="@{/js/trading-dashboard.js}"></script>

</body>
</html>
